@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="container-sm">
    <div class="text-bg-warning pt-1 py-1 px-2 pe-2 rounded-2 mb-4 d-inl">
        Don't post your <b style="color: var(--bs-danger)">sensitive</b> information to the chat box.
    </div>

    <div class="row text-bg-light">
        <div class="col-4 d-flex align-items-center gap-2">
            <i class="bi bi-person-circle"></i>
            <input class="form-control" id="userInput" placeholder="Your name" />
        </div>
        <div class="col-4 d-flex align-items-center gap-2">
            <i class="bi bi-chat-right-dots me-1"></i>
            <input class="form-control" id="messageInput" placeholder="Type a message..." />
        </div>        
        <div class="col-2 d-flex align-items-center gap-2">
            <button class="btn btn-outline-primary btn-sm" id="sendButton">Send</button>
        </div>
    </div>
    <div class="row gap-1">
        <ul id="messagesList"></ul>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chathub")
        .build();

    connection.on("ReceiveMessage", (user, message, timestamp) => {
        const li = document.createElement("li");
        li.textContent = `${user} [${new Date(timestamp).toLocaleTimeString()}]: ${message}`;
        document.getElementById("messagesList").appendChild(li);
    });

    connection.start().then(() => {
        document.getElementById("sendButton").addEventListener("click", () => {
            const user = document.getElementById("userInput").value;
            const message = document.getElementById("messageInput").value;
            connection.invoke("SendMessage", user, message);
        });
    });
</script>
